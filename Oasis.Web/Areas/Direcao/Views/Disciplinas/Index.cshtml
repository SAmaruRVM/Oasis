@model DisciplinasViewModel
@inject IConfiguration configuration
@{
    Layout = "~/Views/Escola/Shared/_Layout.cshtml";
    ViewBag.Title = $"Direção {configuration["Projeto:Nome"]} - Disciplinas";
}



<div class="container-fluid">
    <div class="row p-5">
        <div class="col-6 border-right">
            <table class="table">
                <thead class="thead-light">
                    <tr>
                        <th scope="col">Disciplina</th>
                        <th scope="col">Data de criação</th>
                        <th scope="col">Criador</th>
                        <th scope="col">Acções</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Disciplina disciplina in Model.Disciplinas)
                    {
                        <tr>
                            <td>@disciplina.Nome</td>
                            <td>@disciplina.DataCriacao</td>
                            <td>@disciplina.CriadorDirecao.PrimeiroNome @disciplina.CriadorDirecao.Apelido</td>
                            <td>
                                <button type="button" data-disciplina-id="@disciplina.Id" data-disciplina-atualizar="true"><i class="far fa-edit fa-lg ml-1"></i></button>
                                <button type="button" data-disciplina-id="@disciplina.Id" data-disciplina-eliminar="true" data-toggle="modal" data-target="#modal-eliminar-disciplina"><i class="far fa-trash-alt fa-lg ml-2"></i></button>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        <div class="col-6">
            <div class="p-5">
                <form id="form-inserir-disciplina"
                      class="w-100"
                      asp-action="Criar"
                      asp-controller="Disciplinas"
                      asp-area="Direcao"
                      asp-antiforgery="true"
                      data-ajax="true"
                      data-ajax-method="POST"
                      data-ajax-success="disciplinaInserida"
                      data-ajax-loading="#loading-icon-disciplina">
                    <div class="form-group">
                        <label asp-for="Disciplina.Nome"></label>
                        <input class="form-control" asp-for="Disciplina.Nome" />
                        <span class="text-danger text-center" asp-validation-for="Disciplina.Nome"></span>
                    </div>
                    <button class="btn btn-primary btn-block" type="submit">
                        <i id="loading-icon-disciplina" style="display: none;" class="fas fa-spinner fa-spin"></i>
                        Inserir disciplina
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>




<!-- Modals -->
<div class="modal fade" id="modal-eliminar-disciplina" tabindex="-1" role="dialog"
     aria-labelledby="modal-eliminar-disciplina-titulo" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modal-eliminar-disciplina-titulo">Eliminação da disciplina selecionada</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form asp-action="Eliminar"
                      asp-controller="Disciplinas" asp-area="Direcao" asp-antiforgery="true" data-ajax="true"
                      data-ajax-method="POST" data-ajax-success="disciplinaEliminada"
                      data-ajax-loading="#loading-icon-eliminacao-disciplina"
                      asp-route-id="3">
                    <p id="eliminar-disciplina-texto-confirmacao">pretende mesmo eliminar x?</p>
                    <button type="submit" class="btn btn-primary">Confirmar eliminação</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancelar eliminação</button>
            </div>
        </div>
    </div>
</div>




@section Scripts {
    <partial name="~/Views/Shared/_Validacoes.cshtml" />
    <partial name="~/Views/Shared/_Ajax.cshtml" />
    <script>
        function disciplinaInserida(respostaAjax) {
            if (!(respostaAjax.ocorreuAlgumErro)) {
                document.getElementById('form-inserir-disciplina').reset();
            }
            ajaxCompleto(respostaAjax);
        }
        function disciplinaEliminada(respostaAjax) {
            if (!(respostaAjax.ocorreuAlgumErro)) {
                $('#modal-eliminar-disciplina').modal('hide');
            }
            ajaxCompleto(respostaAjax);
        }

        const eliminarDisciplinaBtns = document.querySelectorAll('button[data-disciplina-eliminar="true"]');
        const atualizarDisciplinaBtns = document.querySelectorAll('button[data-disciplina-atualizar="true"]');
        eliminarDisciplinaBtns.forEach(btn => btn.addEventListener('click', () =>
        {
            const textoConfirmacao = document.getElementById('eliminar-disciplina-texto-confirmacao');
            textoConfirmacao.innerText = btn.getAttribute('data-disciplina-id');

        }));
    </script>
}